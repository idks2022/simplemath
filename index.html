<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>חשבון פשוט</title>
<style>
    body {
        font-family: Arial, sans-serif;
        font-size: x-large;
        margin: 0;
        padding: 0;
        background-color: #333;
        color: #fff;
    }
    .container {
        max-width: 600px;
        margin: auto;
        padding: 2rem;
        background-color: #444;
        border-radius: 10px;
        direction: rtl; /* Right-to-left content */
    }
    input {
        max-width: 60px;
        padding: 0.5rem;
        margin-bottom: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #333;
        color: #fff;
        font-size: large;
    }
    input.wide{
        max-width: 180px;
    }
    input.wider{
        max-width: 120px;
    }
    #output {
        margin-bottom: 1rem;
    }
    .ltr{
        direction: ltr;
    }
    .button {
        padding: 0.5rem 2rem;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .button:hover {
        background-color: #0056b3;
    }
    .button.dark{
        background-color: #0056b3;
    }
    table {
        width: 70%;
        margin-bottom: 1rem;
        border-collapse: collapse;
    }
    td {
        padding: 0.5rem;
        text-align: center;
        max-width: 60px;
    }
  
    /* Dark mode styles */
    body.dark-mode {
        background-color: #111;
        color: #ddd;
    }

    .container.dark-mode {
        background-color: #222;
    }

    .green{
        color: #4caf50;
    }

    table.dark-mode {
        border-color: #555;
    }
    .bigFont{
        font-size: xx-large;
    }
</style>

</head>

<body>

<div class="container" id="main">
    <div id="setupTitle" >
        <div id="execTodoLabel"  style="display: inline-block;">נותרו:</div>
        <div id="execTodo" style="display: inline-block;">3</div>
        <div id="timer" style="display: inline-block;"></div>
    </div>
    <p id="question"></p>
    <div id="answerDiv" class="ltr">
        <input type="number" id="answer" placeholder="מה התשובה" class="wide">
    </div>
    <div id="output"></div>
    <input id="newGame" class="dark wider" value="משחק חדש"></input>
    <div class="ltr">
    <input id="submit"  value="שלח" class="button" style="display:none"></input>
    </div>
</div>

    
<div class="container" id="setup">
    <div id="setupTitle" >
        <div id="numberOfExercise"  style="display: inline-block;">תרגילים:</div>
        <input id="numberOfExerciseInput" value=3></input>
    </div>
     <table ><tbody id="tbody"></tbody></table>
     <input id="setupBtn"></input>
     
</div>

</body>

<!--                          SCRIPT                      -->
<script>
const isPhone = () => {
    console.log("Phone")
    return navigator.userAgentData.mobile
}

const answerInput = document.getElementById("answer")
const submit = document.getElementById("submit")
const output = document.getElementById('output')
const setup = document.getElementById('setup')
const execTodoE = document.getElementById('execTodo')
const main = document.getElementById('main') ;//main.style.display = 'None'
const que = document.getElementById('question')

if (isPhone()) submit.style.display = 'block'

timerE = document.getElementById('timer');
timerE.value = 0
timerE.classList.add("ltr")
timerE.style.fontFamily = "courier"

const okImage = '😄';2
const errImage = '👎';

const Actions = [];
let initExercise = false


let result = 0;
que.classList.add("ltr")
    
function getRandomInt(max, min=0) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}



let timerInterval = undefined
const startTimer = ()  =>{
    timerE.value = 0
    timerInterval = setInterval(()=>{
        timerE.value = timerE.value +1
        let val = timerE.value
        timerE.innerHTML = `(${Math.floor(val / 3600)}:
        ${Math.floor(val /60)- Math.floor(val / 3600)*60}:
        ${val % 60})`
        }
        , 1000)
}

const stopTimer = ()  => clearInterval(timerInterval)
let CalculatedResult = 0
let Counter = 0
let NExercise = 0

class Exercises{
    constructor (){
        stopTimer()
        startTimer()
        answerInput.value = ""
        answerInput.disabled = false;
        output.innerText = "";
        que.innerText = "";
       

        if (initExercise == false){
            this.initialize()
        }
        NExercise = document.getElementById("numberOfExerciseInput").value
        Counter = 0
        this.result = 0
        this.nextExercise()
        numberOfExerciseInput.value = NExercise - Counter

    }

    initialize = () =>{
        answerInput.addEventListener("keydown", (event) => {
             if (event.keyCode === 13) {
                event.preventDefault();
                this.submitAnswer();
        }
        })

        submit.addEventListener("click", (event) => this.submitAnswer())
            
        initExercise = true
    }

     
    nextExercise = () =>{
        execTodo.textContent = NExercise - Counter
        let randomIndex = getRandomInt(Actions.length-1);
        let action = Actions[randomIndex]
    
        let [sign, mix_n , max_n] = [action[0], action[1].value, action[2].value]
        let range = [ getRandomInt(max_n,mix_n), getRandomInt(max_n,mix_n)]
        sign = sign.replace('x', '*')
        let big = Math.max(...range)
        let small = Math.min(...range)
        if (sign == '/'){
            big = small * big;          
        }
        let exercise = `${big} ${sign} ${small}`
        que.innerText = `${exercise} = ?`;
        CalculatedResult = eval(exercise)
    }
    
    submitAnswer = ()=>{
       
        if (parseInt(answerInput.value) ==  CalculatedResult){
            Counter +=1
            execTodo.textContent = NExercise - Counter
            output.innerText += okImage
            if (NExercise - Counter <=0 ){
                this.finish()
            }else{
                this.nextExercise()
            }
        }else{
            output.innerText += errImage
        }
        answerInput.value =""
        
    }

    finish() {
        let doneText = okImage.repeat(10);
        output.innerText = doneText + '\n';
        que.innerText = doneText + '\n';
        answerInput.disabled = true;
        stopTimer()
    }
}
    
function userSetup() {
    const tbody = document.querySelector('tbody');
    while (tbody.firstChild) {
        tbody.removeChild(tbody.firstChild);
    }

    for (let action of ["+", "x", "-" , "/"]) {    
        let tr  = document.createElement("tr")
        // sign
        let tdlabel = document.createElement("td")
        tdlabel.innerText = action
        tdlabel.classList.add("green", "bigFont")

        // min
        let td_min = document.createElement("td")
        let td_min_input = document.createElement("input")  
        td_min_input.value = 1
        td_min.appendChild(td_min_input)

        // arrow
        let td_lable = document.createElement("td")
        td_lable.innerHTML =  '\u2190'

        // max
        let td_max = document.createElement("td")
        let td_max_input = document.createElement("input")
        td_max_input.value = 10
        td_max.appendChild(td_max_input)

        for (let td of [tdlabel,td_min,td_lable,td_max]){
            tr.appendChild(td)    
        }
        tbody.appendChild(tr)
        Actions.push([action, td_min_input,  td_max_input])
    }
}

// settings  buttons listeners 
(()=>{
    newGame = document.getElementById("newGame")
    newGame.classList.add("button")
    newGame.value =  "משחק חדש";
    newGame.addEventListener("click", function(event) {
        event.preventDefault();
        setup.style.display = 'block'
        main.style.display ='None'
        userSetup();
    })

    setupBtn = document.getElementById("setupBtn")
    setupBtn.classList.add("button", )
    setupBtn.value = "התחל"
    setupBtn.addEventListener("click", function(event) {
        event.preventDefault();
        setup.style.display = 'None'
        main.style.display ='block'

        new Exercises();
    })
    
})();
userSetup()
</script>

</html>